# -*- coding: utf-8 -*-
"""
Created on Fri Feb 27 11:42:12 2015

@author: chenj
@note: the purpose of this script is to sample from all the *.asm files from 
Microsoft Malware classification problem data set
"""
import os
import random as rd
import pandas as pd


path = os.path.dirname(os.path.realpath(__file__))
os.chdir(path)

flabel = 'trainLabels.csv'
trainLabels = pd.read_csv(flabel)

trainLabels.groupby('Class', as_index = False).aggregate(len)
'''
   Class    Id
0      1  1541
1      2  2478
2      3  2942
3      4   475
4      5    42
5      6   751
6      7   398
7      8  1228
8      9  1013
'''
# since the number of different classes are not evenly distributed, we sample 100 
# from all class except Class5, and use all 42 class 5 in the sample

rd.seed(88)
filelist = []
for i in range(1,10):
    this = trainLabels[trainLabels['Class'] == i]
    K = 42 if i == 5 else 100 
    sample = rd.sample(this.index, K)
    sample.sort()
    filelist.append(this.loc[sample, 'Id'].values.tolist())

# flatten the list  
filelist = [item for sublist in filelist for item in sublist]
 
os.mkdir(os.getcwd() + '\\asmSample\\')

# extract the file
for Id in filelist:
    infile = 'train.7z'
    fname  = 'train\\' + Id + '.asm'
    os.system('7za e ' + infile + ' ' + fname)
